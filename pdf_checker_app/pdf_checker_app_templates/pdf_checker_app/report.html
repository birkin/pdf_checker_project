{% extends "pdf_checker_app/base.html" %}

{% block title %}Report - {{ document.original_filename }}{% endblock %}

{% block content %}
<div class="card">
    <h1>PDF Accessibility Report</h1>
    
    <div class="document-info">
        <h2>Document Information</h2>
        <dl>
            <dt>File:</dt>
            <dd>{{ document.original_filename }}</dd>
            
            <dt>Uploaded by:</dt>
            <dd>{{ document.user_first_name }} {{ document.user_last_name }} {% if document.user_email %}({{ document.user_email }}){% endif %}</dd>
            
            <dt>Uploaded:</dt>
            <dd>{{ document.uploaded_at|date:"Y-m-d H:i" }}</dd>
            
            <dt>Size:</dt>
            <dd>{{ document.file_size|filesizeformat }}</dd>
            
            <dt>Status:</dt>
            <dd>{{ document.get_processing_status_display }}</dd>
        </dl>
    </div>
    
    <!-- Status section with htmx polling -->
    {% include "pdf_checker_app/fragments/status_fragment.html" %}
    
    <!-- Summary section (future: populated when OpenRouter summary is ready) -->
    {% include "pdf_checker_app/fragments/summary_fragment.html" %}
    
    <!-- veraPDF results container (populated via htmx when ready) -->
    {% if document.processing_status == 'completed' and verapdf_raw_json %}
    <div id="verapdf-container" class="raw-json">
        <h2>veraPDF Response</h2>
        <p id="verapdf-comfort-note">Note: veraPDF may sometimes report thousands of "failed checks" -- but that does _not_ mean thousands of distinct problems. Think of a "failed check" as a repeated warning bell, not a separate task. Example: if the PDF lacks a language setting, or proper tagging, veraPDF will flag each affected text snippet or layout element, inflating totals. Remediation work should target a few root causes, which can clear thousands of checks quickly.</p>
        <details>
            <summary>Show raw JSON</summary>
            <pre>{{ verapdf_raw_json }}</pre>
        </details>
    </div>
    {% else %}
    <div id="verapdf-container">
        <!-- veraPDF results will appear here when processing completes -->
    </div>
    {% endif %}
    
    <div class="actions">
        <a href="{% url 'pdf_upload_url' %}" class="btn btn-secondary">
            Upload Another PDF
        </a>
    </div>
</div>
{% endblock %}
